<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Le Monde des Curieux - Accueil</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles/home-page.css">
    <link rel="stylesheet" href="styles/side-menu-unified.css">
    <link rel="stylesheet" href="styles/mindmap_svg.css">
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script src="scripts/mission-histoire.js"></script>
    <script src="scripts/mission-robots.js"></script>
    <script src="scripts/mission-sciences.js"></script>
    <script src="scripts/mission-francais.js"></script>
    <script src="scripts/mission-english.js"></script>
    
    <style>
        /* Styles additionnels pour le header avec bouton */
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            gap: 20px;
        }
        
        .header-text {
            flex: 1;
        }
        
        .stats-btn {
            font-family: 'Press Start 2P', cursive;
            font-size: 11px;
            padding: 12px 20px;
            border: 4px solid #2c3e50;
            border-radius: 10px;
            background: linear-gradient(135deg, #2a9d8f 0%, #1d7a6f 100%);
            color: white;
            cursor: pointer;
            box-shadow: 4px 4px 0 rgba(44, 62, 80, 0.3);
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .stats-btn:hover {
            transform: translateY(-3px);
            box-shadow: 6px 6px 0 rgba(44, 62, 80, 0.4);
        }
        
        .stats-btn:active {
            transform: translateY(1px);
            box-shadow: 3px 3px 0 rgba(44, 62, 80, 0.3);
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .stats-btn {
                font-size: 9px;
                padding: 10px 15px;
            }
        }
    </style>
</head>
<body class="home-page">

    <button class="menu-toggle-btn" onclick="toggleSideMenu()" aria-label="Ouvrir le menu">
        ‚ò∞
    </button>

    <header class="main-header">
        <div class="header-content">
            <div class="header-text">
                <h1>üéÆ Le Monde des Curieux</h1>
                <p>Instruction en Famille & R√©ussite Scolaire</p>
            </div>
            <button class="stats-btn" onclick="window.location.href='dashboard-analytics.html'">
                üìä Statistiques
            </button>
        </div>
    </header>

    <main class="game-container">
        <section class="map-section">
            <div class="mindmap-container">
                <svg viewBox="0 0 1024 1024" class="mindmap-svg">
                    <image href="images/mindmap_lemondedescurieux_v2.png" width="1024" height="1024"/>
                    <a href="francais_duolingo_section.html"><circle class="zone-clickable" cx="209" cy="270" r="85"></circle></a>
                    <a href="maths_duolingo_section.html"><circle class="zone-clickable" cx="809" cy="271" r="85"></circle></a>
                    <a href="histoire_duolingo_section.html"><circle class="zone-clickable" cx="125" cy="491" r="85"></circle></a>
                    <a href="english_duolingo_section.html"><circle class="zone-clickable" cx="900" cy="490" r="85"></circle></a>
                    <a href="sciences_duolingo_section.html"><circle class="zone-clickable" cx="182" cy="724" r="80"></circle></a>
                    <a href="ressources_section.html"><circle class="zone-clickable" cx="843" cy="724" r="85"></circle></a>
                    <a href="infos_section.html"><circle class="zone-clickable" cx="641" cy="846" r="80"></circle></a>
                    <a href="index-dashboard.html"><circle class="zone-clickable" cx="392" cy="844" r="75"></circle></a>
                </svg>
            </div>
        </section>

        <aside class="sidebar-section">
            <div class="card">
                <h2>üìä Statistiques</h2>
                <div style="font-size: 10px;">‚≠ê <span id="xp-val">0</span> XP | üéØ <span id="mission-val">0</span>/5</div>
            </div>

            <div class="card">
                <h2>üöÄ Missions Sp√©ciales</h2>
                <div class="mission-list">
                    <div class="mission-item">üëë Le Roi Soleil <button id="btn-roi-soleil" onclick="startMission(missionHistoire)" class="play-btn">Jouer</button></div>
                    <div class="mission-item">üíß Cycle de l'Eau <button id="btn-cycle-eau" onclick="startMission(missionEau)" class="play-btn">Jouer</button></div>
                    <div class="mission-item">ü§ñ Univers Robots <button id="btn-robots_01" onclick="startMission(missionRobots)" class="play-btn">Jouer</button></div>
                    <div class="mission-item">üìö D√©tective Mots <button id="btn-francais_01" onclick="startMission(missionFrancais)" class="play-btn">Jouer</button></div>
                    <div class="mission-item">üá¨üáß English Adventure <button id="btn-english_01" onclick="startMission(missionEnglish)" class="play-btn">Jouer</button></div>
                </div>
                <button onclick="resetProgression()" class="reset-btn">R√âINITIALISER TOUT</button>
            </div>
        </aside>
    </main>

    <div id="quiz-overlay" class="quiz-overlay" style="display:none;">
        <div class="quiz-box" id="quiz-card">
            <div id="quiz-header"></div>
            <div id="quiz-body"></div>
            <div id="feedback" style="margin-top:15px; font-size:10px; min-height: 15px;"></div>
        </div>
    </div>

    <div id="reset-modal" class="custom-modal">
        <div class="modal-content">
            <p style="font-size: 10px; line-height: 1.6; margin-bottom: 20px;">‚ö†Ô∏è ATTENTION !<br><br>Veux-tu vraiment effacer toute ta progression ?</p>
            <div class="modal-btns">
                <button class="btn-confirm" onclick="confirmReset()">OUI !</button>
                <button class="btn-cancel" onclick="closeResetModal()">NON</button>
            </div>
        </div>
    </div>

    <script src="scripts/side-menu-unified.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            if (typeof loadSideMenu === "function") loadSideMenu();
            updateUI();
        });

        let currentMission = null;
        let stepIndex = 0;

        function startMission(m) {
            currentMission = m;
            stepIndex = 0;
            document.getElementById('quiz-overlay').style.display = 'flex';
            showStep();
        }

        function showStep() {
            const step = currentMission.steps[stepIndex];
            document.getElementById('quiz-header').innerHTML = `<h3 style="color:#2a9d8f;">${step.subject}</h3>`;
            document.getElementById('quiz-body').innerHTML = `
                <p style="margin:20px 0; font-size:10px; line-height:1.4;">${step.question}</p>
                ${step.options.map((o, i) => `<button class="option-btn" onclick="checkAnswer(${i})">${o}</button>`).join('')}
            `;
            document.getElementById('feedback').innerText = "";
        }

        function checkAnswer(i) {
            const fb = document.getElementById('feedback');
            const card = document.getElementById('quiz-card');

            if (i === currentMission.steps[stepIndex].correct) {
                fb.innerText = "‚úîÔ∏è CORRECT !";
                fb.style.color = "#27ae60";
                setTimeout(() => {
                    stepIndex++;
                    if (stepIndex < currentMission.steps.length) showStep();
                    else finishMission();
                }, 800);
            } else {
                // Effet Vibration (Shake)
                card.classList.remove('shake');
                void card.offsetWidth; // Force le reflow pour relancer l'animation
                card.classList.add('shake');
                
                fb.innerText = "‚ùå R√âESSAIE !";
                fb.style.color = "#e74c3c";
            }
        }

        function finishMission() {
            document.getElementById('quiz-overlay').style.display = 'none';
            let done = JSON.parse(localStorage.getItem('curio_missions') || "[]");
            
            if (!done.includes(currentMission.id)) {
                done.push(currentMission.id);
                localStorage.setItem('curio_missions', JSON.stringify(done));
                let xp = parseInt(localStorage.getItem('curio_xp') || 0) + 50;
                localStorage.setItem('curio_xp', xp);
            }
            updateUI();

            // Effet Doubles Confettis au bout de 5 missions
            if (done.length >= 5) {
                const end = Date.now() + 3000;
                (function frame() {
                    confetti({ particleCount: 5, angle: 60, spread: 55, origin: { x: 0, y: 0.8 } });
                    confetti({ particleCount: 5, angle: 120, spread: 55, origin: { x: 1, y: 0.8 } });
                    if (Date.now() < end) requestAnimationFrame(frame);
                }());
            }
        }

        function updateUI() {
            const done = JSON.parse(localStorage.getItem('curio_missions') || "[]");
            document.getElementById('xp-val').innerText = localStorage.getItem('curio_xp') || 0;
            document.getElementById('mission-val').innerText = done.length;
            
            done.forEach(id => {
                const btn = document.getElementById(`btn-${id}`);
                if (btn) {
                    btn.innerText = "OK";
                    btn.disabled = true;
                }
            });
        }

        // --- LOGIQUE POPUP PERSONNALIS√âE ---
        function resetProgression() {
            document.getElementById('reset-modal').style.display = 'flex';
        }

        function closeResetModal() {
            document.getElementById('reset-modal').style.display = 'none';
        }

        function confirmReset() {
            localStorage.clear();
            location.reload();
        }
    </script>
</body>
</html>


