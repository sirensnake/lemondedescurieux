<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Parcours - Le Monde des Curieux</title>
    
    <link rel="stylesheet" href="styles/home-page.css">
    <link rel="stylesheet" href="styles/dashboard-global.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        /* Animation de c√©l√©bration du Level Up */
        .level-up-flash {
            animation: flashGold 1.5s ease-out;
        }

        @keyframes flashGold {
            0% { box-shadow: 0 0 0px #f1c40f; border-color: #000; }
            50% { box-shadow: 0 0 30px #f1c40f; border-color: #f1c40f; transform: scale(1.05); }
            100% { box-shadow: 0 0 0px #f1c40f; border-color: #000; }
        }
    </style>
</head>
<body class="dashboard-page">

    <button class="menu-btn" onclick="window.location.href='index.html'">üè†</button>

    <div class="main-container">
        <header class="dashboard-header">
            <h1>üìä MON PROGR√àS</h1>
            <a href="index.html" class="back-link">[ üè† Retour √† l'Aventure ]</a>
        </header>

        <section class="stats-grid">
            <div class="card-pixel">
                <h3>‚≠ê SCORE XP</h3>
                <p class="stat-val"><span id="xp-val">0</span></p>
            </div>

            <div class="card-pixel">
                <h3>üéØ MISSIONS</h3>
                <p class="stat-val"><span id="mission-val">0</span></p>
            </div>

            <div class="card-pixel" id="rank-card">
                <h3>RANG ACTUEL</h3>
                <p id="rank-name" style="font-size: 9px; color: #bdc3c7; margin-bottom: 5px; text-transform: uppercase;">CHARGEMENT...</p>
                <p class="stat-val" style="margin-bottom:10px;">NIV. <span id="level-val">1</span></p>
                
                <div style="width: 100%; height: 12px; background: #1a252f; border: 2px solid #000; position: relative; image-rendering: pixelated;">
                    <div id="level-bar" style="height: 100%; background: #f1c40f; width: 0%; transition: width 1s ease-out;"></div>
                </div>
                <p id="next-level-info" style="font-size: 7px; color: #7f8c8d; margin-top: 8px;">0 / 100 XP</p>
            </div>
        </section>

        <section class="inventory-section card-pixel" style="background: rgba(0,0,0,0.2);">
            <h2 class="section-title">üèÜ MES BADGES D√âBLOQU√âS</h2>
            <div class="badges-container" id="badges-grid">
                <p class="empty-msg">Chargement de ton inventaire...</p>
            </div>
        </section>
    </div>

    <script>
        window.onload = () => {
            const xp = parseInt(localStorage.getItem('curio_xp')) || 0;
            const missions = localStorage.getItem('curio_missions_completed') || 0;
            const badges = JSON.parse(localStorage.getItem('curio_badges')) || [];
            const lastLevel = parseInt(localStorage.getItem('curio_last_level')) || 1;

            document.getElementById('xp-val').innerText = xp;
            document.getElementById('mission-val').innerText = missions;

            // Calcul du Niveau
            let level = 1;
            let rank = "Apprenti Curieux";
            let minXP = 0;
            let maxXP = 100;

            if (xp >= 1000) { level = 5; rank = "Ma√Ætre des Savoirs"; minXP = 1000; maxXP = 1000; }
            else if (xp >= 600) { level = 4; rank = "Expert Explorateur"; minXP = 600; maxXP = 1000; }
            else if (xp >= 300) { level = 3; rank = "Voyageur Agr√©√©"; minXP = 300; maxXP = 600; }
            else if (xp >= 100) { level = 2; rank = "Curieux Actif"; minXP = 100; maxXP = 300; }

            // Mise √† jour de la barre
            let percentage = (level === 5) ? 100 : ((xp - minXP) / (maxXP - minXP)) * 100;
            document.getElementById('level-val').innerText = level;
            document.getElementById('rank-name').innerText = rank;
            document.getElementById('next-level-info').innerText = (level === 5) ? "NIVEAU MAXIMUM" : `${xp} / ${maxXP} XP POUR NIV. ${level + 1}`;
            
            setTimeout(() => {
                document.getElementById('level-bar').style.width = percentage + "%";
            }, 300);

            // --- LOGIQUE DE LEVEL UP ---
            if (level > lastLevel) {
                const rankCard = document.getElementById('rank-card');
                rankCard.classList.add('level-up-flash');
                
                if (typeof confetti === 'function') {
                    confetti({
                        particleCount: 150,
                        spread: 70,
                        origin: { y: 0.6 },
                        colors: ['#f1c40f', '#ffffff']
                    });
                }
                localStorage.setItem('curio_last_level', level);
            } else {
                localStorage.setItem('curio_last_level', level);
            }

            // Affichage des Badges
            const container = document.getElementById('badges-grid');
            if (badges.length > 0) {
                container.innerHTML = badges.map(emoji => `
                    <div class="badge-slot">
                        <span class="badge-emoji">${emoji}</span>
                    </div>
                `).join('');
            } else {
                container.innerHTML = `<p class="empty-msg">Inventaire vide. Termine des missions !</p>`;
            }
        };
    </script>
</body>
</html>