<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fran√ßais - Le Monde des Curieux</title>
    <link rel="stylesheet" href="styles/base-style.css">
    <link rel="stylesheet" href="styles/francais_duolingo.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="styles/xp-display.css">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&amp;display=swap" rel="stylesheet">
</head>
<body>
    <!-- Debug Panel (visible en mode d√©veloppement) -->
    <div id="debug-panel" class="debug-panel" style="display: none;">
        <h3>üîß Debug Mode</h3>
        <div id="debug-info"></div>
        <button onclick="FrenchDebug.toggleDebug()">Toggle Debug</button>
        <button onclick="FrenchDebug.resetProgress()">Reset Progress</button>
        <button onclick="FrenchDebug.testNotifications()">Test Notifications</button>
    </div>

    <!-- Header avec stats utilisateur -->
    <header class="game-header">
        <div class="header-left">
            <button id="back-btn" class="back-button">‚Üê Retour</button>
            <h1>üá´üá∑ Fran√ßais</h1>
        </div>
        
        <div class="header-stats">
            <!-- Streak Counter -->
            <div id="streak-display" class="stat-item">
                <span class="streak-flame">üî•</span>
                <span id="streak-count">0</span>
                <span class="stat-label">jours</span>
            </div>
            
            <!-- Hearts/Lives -->
            <div id="hearts-display" class="stat-item">
                <!-- Hearts g√©n√©r√©s dynamiquement -->
            </div>
            
            <!-- XP Bar -->
            <div id="xp-display" class="stat-item">
                <div class="xp-container">
                    <div class="xp-bar">
                        <div id="xp-fill" class="xp-fill"></div>
                    </div>
                    <span id="xp-text">0 XP</span>
                </div>
            </div>
        </div>
    </header>

    <div id="xp-display-container"></div>

    <!-- Main Content -->
    <main class="main-content">
        <!-- √âcran d'accueil -->
        <section id="welcome-screen" class="screen active">
            <div class="welcome-content">
                <div class="curio-welcome">
                    <img src="images/curio-thinking.png" alt="Curio r√©fl√©chit" class="curio-image">
                    <div class="speech-bubble">
                        <p>Salut ! Pr√™t √† am√©liorer ton fran√ßais ? üéØ</p>
                        <p>Tu vas gagner des XP et maintenir ton streak !</p>
                    </div>
                </div>
                
                <div class="quick-stats">
                    <div class="stat-card">
                        <span class="stat-number" id="total-lessons">0</span>
                        <span class="stat-label">le√ßons compl√©t√©es</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="longest-streak">0</span>
                        <span class="stat-label">plus long streak</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="total-xp">0</span>
                        <span class="stat-label">XP total</span>
                    </div>
                </div>
                
                <button id="start-learning-btn" class="primary-button pulse">
                    Commencer ! üöÄ
                </button>
            </div>
        </section>

        <!-- S√©lection des le√ßons -->
        <section id="lessons-screen" class="screen">
            <div class="lessons-header">
                <h2>Choisis ta le√ßon</h2>
                <div class="difficulty-selector">
                    <button class="difficulty-btn active" data-level="easy">Facile</button>
                    <button class="difficulty-btn" data-level="medium">Moyen</button>
                    <button class="difficulty-btn" data-level="hard">Difficile</button>
                </div>
            </div>
            
            <div id="lessons-grid" class="lessons-grid">
                <!-- Le√ßons g√©n√©r√©es dynamiquement -->
            </div>
        </section>

        <!-- √âcran de le√ßon active -->
        <section id="lesson-screen" class="screen">
            <div class="lesson-header">
                <div class="lesson-progress">
                    <div class="progress-bar">
                        <div id="lesson-progress-fill" class="progress-fill"></div>
                    </div>
                    <span id="question-counter">1/10</span>
                </div>
                <button id="quit-lesson-btn" class="quit-button">‚úï</button>
            </div>
            
            <div class="lesson-content">
                <div id="question-area" class="question-area">
                    <!-- Question g√©n√©r√©e dynamiquement -->
                </div>
                
                <div id="answer-area" class="answer-area">
                    <!-- R√©ponses g√©n√©r√©es dynamiquement -->
                </div>
                
                <div id="feedback-area" class="feedback-area">
                    <!-- Feedback affich√© apr√®s r√©ponse -->
                </div>
            </div>
            
            <div class="lesson-controls">
                <button id="hint-btn" class="hint-button">üí° Indice</button>
                <button id="check-answer-btn" class="primary-button" disabled>V√©rifier</button>
            </div>
        </section>

        <!-- √âcran de r√©sultats -->
        <section id="results-screen" class="screen">
            <div class="results-content">
                <div class="results-header">
                    <img id="results-curio" src="images/curio-happy.png" alt="Curio content" class="curio-image">
                    <h2 id="results-title">Excellent travail ! üéâ</h2>
                </div>
                
                <div class="results-stats">
                    <div class="result-item">
                        <span class="result-icon">‚úÖ</span>
                        <span id="correct-answers">8</span>
                        <span>bonnes r√©ponses</span>
                    </div>
                    <div class="result-item">
                        <span class="result-icon">‚≠ê</span>
                        <span id="xp-gained">+50</span>
                        <span>XP</span>
                    </div>
                    <div class="result-item">
                        <span class="result-icon">üî•</span>
                        <span id="streak-bonus">+10</span>
                        <span>bonus streak</span>
                    </div>
                </div>
                
                <div class="results-actions">
                    <button id="continue-btn" class="primary-button">Continuer</button>
                    <button id="replay-btn" class="secondary-button">Rejouer</button>
                </div>
            </div>
        </section>

        <!-- √âcran sans c≈ìurs -->
        <section id="no-hearts-screen" class="screen">
            <div class="no-hearts-content">
                <div class="curio-sad">
                    <img src="images/curio-sad.png" alt="Curio triste" class="curio-image">
                    <div class="speech-bubble">
                        <p>Oops ! Plus de c≈ìurs ! üíî</p>
                        <p>Attends <span id="heart-regen-timer">29:45</span> ou regarde une pub pour continuer.</p>
                    </div>
                </div>
                
                <div class="hearts-options">
                    <button id="wait-hearts-btn" class="secondary-button">
                        ‚è∞ Attendre la r√©cup√©ration
                    </button>
                    <button id="practice-mode-btn" class="primary-button">
                        üìö Mode entra√Ænement (sans c≈ìurs)
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- Notification popup -->
    <div id="notification" class="notification">
        <div class="notification-content">
            <span id="notification-text"></span>
            <button id="notification-close">‚úï</button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="scripts/francais-storage.js"></script>
    <script src="scripts/francais-hearts.js"></script>
    <script src="scripts/francais-streaks.js"></script>
    <script src="scripts/francais-lessons.js"></script>
    <script src="scripts/francais-app.js"></script>
    
    <!-- Script d'initialisation critique -->
    <script>
        // Initialisation imm√©diate avec gestion d'erreurs
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üéØ DOM loaded, initializing French Duolingo...');
            
            try {
                // V√©rification des d√©pendances
                if (typeof FrenchStorage === 'undefined') {
                    throw new Error('FrenchStorage not loaded');
                }
                if (typeof FrenchHearts === 'undefined') {
                    throw new Error('FrenchHearts not loaded');
                }
                if (typeof FrenchStreaks === 'undefined') {
                    throw new Error('FrenchStreaks not loaded');
                }
                if (typeof FrenchApp === 'undefined') {
                    throw new Error('FrenchApp not loaded');
                }
                
                // Initialisation avec debug
                window.frenchApp = new FrenchApp();
                console.log('‚úÖ French Duolingo initialized successfully');
                
                // Debug mode pour d√©veloppement
                if (window.location.search.includes('debug=true')) {
                    document.getElementById('debug-panel').style.display = 'block';
                    window.frenchApp.enableDebugMode();
                }
                
            } catch (error) {
                console.error('‚ùå French Duolingo initialization failed:', error);
                
                // Affichage d'erreur utilisateur
                document.body.innerHTML = `
                    <div style="padding: 20px; text-align: center; font-family: Arial;">
                        <h2>üîß Erreur de chargement</h2>
                        <p>La section Fran√ßais n'a pas pu se charger correctement.</p>
                        <p><strong>Erreur:</strong> ${error.message}</p>
                        <button onclick="location.reload()">Recharger la page</button>
                        <br><br>
                        <a href="index.html">‚Üê Retour √† l'accueil</a>
                    </div>
                `;
            }
        });
        
        // Test de fonctionnement des boutons (debug)
        function testButtons() {
            console.log('üß™ Testing button functionality...');
            
            const buttons = document.querySelectorAll('button');
            buttons.forEach((btn, index) => {
                console.log(`Button ${index}: ${btn.textContent} - ${btn.onclick ? 'Has click handler' : 'No click handler'}`);
            });
        }
        
        // Exposer fonctions de debug globalement
        window.FrenchDebug = {
            testButtons,
            getAppInstance: () => window.frenchApp,
            resetProgress: () => {
                localStorage.clear();
                location.reload();
            },
            toggleDebug: () => {
                const panel = document.getElementById('debug-panel');
                panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            },
            testNotifications: () => {
                if (window.frenchApp) {
                    window.frenchApp.showNotification('üß™ Test notification', 'success');
                }
            },
            getPerformanceMetrics: () => {
                return {
                    localStorage: localStorage.length + ' keys',
                    memoryUsage: navigator.deviceMemory || 'unknown',
                    connection: navigator.connection?.effectiveType || 'unknown'
                };
            }
        };
        
        // Log pour diagnostic
        console.log('üìã French Duolingo - Diagnostic Info:');
        console.log('- User Agent:', navigator.userAgent);
        console.log('- Local Storage available:', typeof Storage !== 'undefined');
        console.log('- Page URL:', window.location.href);
        console.log('- Script loading order: Storage ‚Üí Hearts ‚Üí Streaks ‚Üí Lessons ‚Üí App');
    </script>
    <script src="./scripts/xp_system_complete.js"></script>
    <script src="scripts/xp-progression-system.js"></script>
    <script src="scripts/gamification-bridge.js"></script>
</body>
</html>