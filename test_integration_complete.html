<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Syst√®me Complet - Le Monde des Curieux</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    
    <!-- Styles existants simul√©s -->
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #2a9d8f;
        }
        
        .test-button {
            background: #2a9d8f;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-family: 'Press Start 2P', cursive;
            font-size: 10px;
        }
        
        .test-button:hover {
            background: #264653;
            transform: translateY(-2px);
        }
        
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .console-output {
            background: #2d3748;
            color: #00ff88;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin: 10px 0;
        }
        
        .simulation-area {
            border: 2px dashed #2a9d8f;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .metric-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            text-align: center;
        }
        
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #2a9d8f;
        }
        
        .metric-label {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
        }
    </style>
    
    <!-- CSS XP int√©gr√© inline pour test autonome -->
    <style>
        /* Styles XP essentiels pour test */
        .xp-display-container {
            display: flex;
            align-items: center;
            gap: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 10px 20px;
            border-radius: 15px;
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            margin: 10px 0;
            flex-wrap: wrap;
        }
        
        .xp-level-badge {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: rgba(255,255,255,0.2);
            padding: 8px 12px;
            border-radius: 10px;
            min-width: 60px;
        }
        
        .level-number {
            font-size: 24px;
            font-weight: bold;
            line-height: 1;
            font-family: 'Press Start 2P', cursive;
        }
        
        .level-label {
            font-size: 12px;
            opacity: 0.9;
            font-family: 'Press Start 2P', cursive;
        }
        
        .xp-progress-section {
            flex: 1;
            min-width: 200px;
        }
        
        .xp-bar-container {
            position: relative;
        }
        
        .xp-bar {
            background: rgba(255,255,255,0.3);
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        
        .xp-bar-fill {
            background: linear-gradient(90deg, #00ff88, #00cc6a);
            height: 100%;
            border-radius: 10px;
            transition: width 0.8s ease-in-out;
            box-shadow: 0 0 10px rgba(0,255,136,0.5);
        }
        
        .xp-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
            z-index: 1;
            font-family: 'Press Start 2P', cursive;
        }
        
        .weekly-xp {
            font-size: 14px;
            opacity: 0.9;
            white-space: nowrap;
            font-family: 'Press Start 2P', cursive;
        }
        
        /* Animation level up simplifi√©e pour test */
        .level-up-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        .level-up-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            color: white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>üéÆ Test Syst√®me Gamifi√© Complet</h1>
            <p><strong>Le Monde des Curieux</strong> - Validation Streaks + Hearts + XP</p>
        </div>

        <!-- Zone d'affichage XP (sera inject√©e automatiquement) -->
        <div class="simulation-area">
            <h3>üéØ Interface Gamifi√©e Live</h3>
            <div id="xp-integration-point">
                <!-- XP Manager s'injectera ici -->
            </div>
        </div>

        <!-- Tests fonctionnels -->
        <div class="test-section">
            <h3>‚ö° Tests Fonctionnels</h3>
            
            <button class="test-button" onclick="runInitializationTest()">
                1. Test Initialisation
            </button>
            
            <button class="test-button" onclick="runXPGainTest()">
                2. Test Gain XP
            </button>
            
            <button class="test-button" onclick="runLevelUpTest()">
                3. Test Level Up
            </button>
            
            <button class="test-button" onclick="runIntegrationTest()">
                4. Test Int√©gration Compl√®te
            </button>
            
            <button class="test-button" onclick="runStressTest()">
                5. Test Robustesse
            </button>
            
            <div id="test-status"></div>
        </div>

        <!-- M√©triques en temps r√©el -->
        <div class="test-section">
            <h3>üìä M√©triques Syst√®me</h3>
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value" id="metric-level">-</div>
                    <div class="metric-label">Niveau Actuel</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="metric-xp">-</div>
                    <div class="metric-label">XP Total</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="metric-progress">-</div>
                    <div class="metric-label">Progression (%)</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="metric-weekly">-</div>
                    <div class="metric-label">XP Semaine</div>
                </div>
            </div>
        </div>

        <!-- Simulation utilisateur enfant -->
        <div class="test-section">
            <h3>üß™ Simulation Enfant Testeur</h3>
            <p><strong>Sc√©nario :</strong> Enfant d√©couvre interface, r√©alise activit√©s, gagne XP</p>
            
            <button class="test-button" onclick="simulateChildSession()">
                ‚ñ∂Ô∏è Lancer Simulation Compl√®te
            </button>
            
            <button class="test-button" onclick="simulateQuickActivity()">
                üéØ Activit√© Quiz Rapide
            </button>
            
            <button class="test-button" onclick="simulatePerfectStreak()">
                üî• Session Parfaite Streak
            </button>
            
            <div id="simulation-log" class="console-output" style="display:none;"></div>
        </div>

        <!-- Console Debug -->
        <div class="test-section">
            <h3>üîß Debug Console</h3>
            <button class="test-button" onclick="toggleConsole()">
                Toggle Console
            </button>
            <button class="test-button" onclick="clearConsole()">
                Clear Log
            </button>
            <button class="test-button" onclick="exportTestData()">
                Export Data
            </button>
            
            <div id="debug-console" class="console-output"></div>
        </div>
    </div>

    <!-- Scripts int√©gr√©s pour test autonome -->
    <script>
        // Simulation des syst√®mes existants pour test
        class MockStreakManager {
            constructor() {
                this.streakData = {
                    currentStreak: 3,
                    longestStreak: 7,
                    lastActivityDate: new Date().toISOString().split('T')[0]
                };
            }
        }

        class MockHeartSystem {
            constructor() {
                this.heartsData = {
                    currentHearts: 4,
                    maxHearts: 5,
                    lastHeartLoss: null
                };
            }
        }

        // Variables globales de test
        let testResults = [];
        let consoleVisible = false;

        // Mock des syst√®mes pour test autonome
        window.streakManager = new MockStreakManager();
        window.heartSystem = new MockHeartSystem();

        // Int√©gration du syst√®me XP (version simplifi√©e pour test)
        class TestXPManager {
            constructor() {
                this.xpData = {
                    currentXP: 150,
                    currentLevel: 1,
                    totalXPEarned: 150,
                    weeklyXP: 75
                };
                this.levelThresholds = {
                    1: 0, 2: 200, 3: 400, 4: 600, 5: 800
                };
                this.initializeXPDisplay();
                this.updateMetrics();
                this.log('‚úÖ XP Manager Test initialis√©');
            }

            addXP(amount, activityType, context = {}) {
                let finalXP = amount;
                let bonusDetails = [];

                // Bonus streak
                if (window.streakManager.streakData.currentStreak > 0) {
                    const bonus = Math.min(window.streakManager.streakData.currentStreak * 2, 20);
                    finalXP += bonus;
                    bonusDetails.push(`üî• Streak +${bonus}XP`);
                }

                // Bonus c≈ìurs
                if (window.heartSystem.heartsData.currentHearts === 5) {
                    finalXP += 10;
                    bonusDetails.push(`üíñ C≈ìurs pleins +10XP`);
                }

                // Bonus perfection
                if (context.perfect) {
                    finalXP *= 2;
                    bonusDetails.push(`‚≠ê Parfait x2`);
                }

                const oldLevel = this.getCurrentLevel();
                this.xpData.currentXP += finalXP;
                this.xpData.totalXPEarned += finalXP;
                this.xpData.weeklyXP += finalXP;

                const newLevel = this.getCurrentLevel();
                let levelUpData = null;
                if (newLevel > oldLevel) {
                    levelUpData = this.handleLevelUp(oldLevel, newLevel);
                }

                this.updateXPDisplay();
                this.updateMetrics();

                const result = {
                    xpGained: finalXP,
                    totalXP: this.xpData.currentXP,
                    currentLevel: newLevel,
                    levelUp: levelUpData,
                    bonusDetails
                };

                this.log(`üìà +${finalXP}XP (${activityType}) - ${bonusDetails.join(', ')}`);
                return result;
            }

            getCurrentLevel() {
                let level = 1;
                for (let [lvl, threshold] of Object.entries(this.levelThresholds)) {
                    if (this.xpData.currentXP >= threshold) {
                        level = parseInt(lvl);
                    } else {
                        break;
                    }
                }
                return level;
            }

            getNextLevelProgress() {
                const currentLevel = this.getCurrentLevel();
                const currentXP = this.xpData.currentXP;
                const currentThreshold = this.levelThresholds[currentLevel] || 0;
                const nextThreshold = this.levelThresholds[currentLevel + 1];

                if (!nextThreshold) {
                    return { progress: 100, remaining: 0, isMaxLevel: true };
                }

                const progressXP = currentXP - currentThreshold;
                const neededXP = nextThreshold - currentThreshold;
                const progressPercent = Math.floor((progressXP / neededXP) * 100);

                return {
                    progress: progressPercent,
                    remaining: nextThreshold - currentXP,
                    total: neededXP,
                    isMaxLevel: false
                };
            }

            handleLevelUp(oldLevel, newLevel) {
                const levelUpData = {
                    oldLevel,
                    newLevel,
                    rewards: [`üéÅ Niveau ${newLevel} atteint!`],
                    timestamp: new Date().toISOString()
                };

                this.showLevelUpAnimation(levelUpData);
                this.log(`üéâ LEVEL UP! ${oldLevel} ‚Üí ${newLevel}`);
                return levelUpData;
            }

            initializeXPDisplay() {
                const container = document.getElementById('xp-integration-point');
                if (!container) return;

                container.innerHTML = `
                    <div class="xp-display-container">
                        <div class="xp-level-badge">
                            <span class="level-number" id="level-number">1</span>
                            <span class="level-label">Niveau</span>
                        </div>
                        <div class="xp-progress-section">
                            <div class="xp-bar-container">
                                <div class="xp-bar">
                                    <div class="xp-bar-fill" id="xp-bar-fill"></div>
                                </div>
                                <span class="xp-text" id="xp-text">0/200 XP</span>
                            </div>
                        </div>
                        <div class="xp-weekly-display">
                            <span class="weekly-xp" id="weekly-xp">0 XP cette semaine</span>
                        </div>
                    </div>
                `;
            }

            updateXPDisplay() {
                const level = this.getCurrentLevel();
                const progress = this.getNextLevelProgress();

                const levelElement = document.getElementById('level-number');
                const xpTextElement = document.getElementById('xp-text');
                const xpBarFill = document.getElementById('xp-bar-fill');
                const weeklyXPElement = document.getElementById('weekly-xp');

                if (levelElement) levelElement.textContent = level;
                if (xpTextElement) {
                    if (progress.isMaxLevel) {
                        xpTextElement.textContent = `${this.xpData.currentXP} XP - Max!`;
                    } else {
                        xpTextElement.textContent = `${this.xpData.currentXP}/${this.levelThresholds[level + 1]} XP`;
                    }
                }
                if (xpBarFill) {
                    xpBarFill.style.width = `${progress.progress}%`;
                }
                if (weeklyXPElement) {
                    weeklyXPElement.textContent = `${this.xpData.weeklyXP} XP cette semaine`;
                }
            }

            updateMetrics() {
                const progress = this.getNextLevelProgress();
                document.getElementById('metric-level').textContent = this.getCurrentLevel();
                document.getElementById('metric-xp').textContent = this.xpData.currentXP;
                document.getElementById('metric-progress').textContent = progress.progress + '%';
                document.getElementById('metric-weekly').textContent = this.xpData.weeklyXP;
            }

            showLevelUpAnimation(levelUpData) {
                const animation = document.createElement('div');
                animation.className = 'level-up-animation';
                animation.innerHTML = `
                    <div class="level-up-content">
                        <h2>üéâ NIVEAU ${levelUpData.newLevel}!</h2>
                        <p>Bravo! Tu progresses super bien!</p>
                        <button onclick="this.parentElement.parentElement.remove()" 
                                style="background:#00ff88;border:none;padding:10px 20px;border-radius:5px;cursor:pointer;margin-top:20px;">
                            Continuer
                        </button>
                    </div>
                `;
                document.body.appendChild(animation);

                setTimeout(() => {
                    if (animation.parentElement) animation.remove();
                }, 5000);
            }

            log(message) {
                const console = document.getElementById('debug-console');
                if (console) {
                    const timestamp = new Date().toLocaleTimeString();
                    console.innerHTML += `<div>[${timestamp}] ${message}</div>`;
                    console.scrollTop = console.scrollHeight;
                }
            }

            debug = {
                addTestXP: (amount = 50) => this.addXP(amount, 'test', { debug: true }),
                simulateLevelUp: () => {
                    const currentLevel = this.getCurrentLevel();
                    const nextThreshold = this.levelThresholds[currentLevel + 1];
                    if (nextThreshold) {
                        const needed = nextThreshold - this.xpData.currentXP + 10;
                        return this.addXP(needed, 'levelup_test', { debug: true });
                    }
                },
                getStats: () => ({
                    level: this.getCurrentLevel(),
                    xp: this.xpData.currentXP,
                    progress: this.getNextLevelProgress(),
                    weekly: this.xpData.weeklyXP
                })
            };
        }

        // Tests fonctionnels
        function runInitializationTest() {
            updateStatus('info', 'üîÑ Test d\'initialisation...');
            
            try {
                // Cr√©er instance XP Manager
                window.testXPManager = new TestXPManager();
                window.XPDebug = window.testXPManager.debug;
                
                // V√©rifier √©l√©ments interface
                const levelElement = document.getElementById('level-number');
                const xpBarElement = document.getElementById('xp-bar-fill');
                
                if (levelElement && xpBarElement) {
                    updateStatus('success', '‚úÖ Initialisation r√©ussie - Interface XP op√©rationnelle');
                    testResults.push({ test: 'Initialisation', status: 'PASS', time: new Date() });
                } else {
                    throw new Error('√âl√©ments interface manquants');
                }
            } catch (error) {
                updateStatus('error', '‚ùå Erreur initialisation: ' + error.message);
                testResults.push({ test: 'Initialisation', status: 'FAIL', error: error.message, time: new Date() });
            }
        }

        function runXPGainTest() {
            updateStatus('info', 'üîÑ Test gain XP...');
            
            try {
                if (!window.testXPManager) {
                    throw new Error('XP Manager non initialis√©');
                }
                
                const initialXP = window.testXPManager.xpData.currentXP;
                const result = window.testXPManager.addXP(25, 'test_activity', { perfect: false });
                
                if (result.xpGained > 0 && window.testXPManager.xpData.currentXP > initialXP) {
                    updateStatus('success', `‚úÖ Gain XP r√©ussi: +${result.xpGained}XP (Total: ${result.totalXP})`);
                    testResults.push({ test: 'Gain XP', status: 'PASS', xpGained: result.xpGained, time: new Date() });
                } else {
                    throw new Error('XP non ajout√© correctement');
                }
            } catch (error) {
                updateStatus('error', '‚ùå Erreur gain XP: ' + error.message);
                testResults.push({ test: 'Gain XP', status: 'FAIL', error: error.message, time: new Date() });
            }
        }

        function runLevelUpTest() {
            updateStatus('info', 'üîÑ Test level up...');
            
            try {
                if (!window.testXPManager) {
                    throw new Error('XP Manager non initialis√©');
                }
                
                const initialLevel = window.testXPManager.getCurrentLevel();
                const result = window.testXPManager.debug.simulateLevelUp();
                
                if (result && result.levelUp) {
                    updateStatus('success', `‚úÖ Level Up r√©ussi: Niveau ${result.levelUp.newLevel}! üéâ`);
                    testResults.push({ test: 'Level Up', status: 'PASS', newLevel: result.levelUp.newLevel, time: new Date() });
                } else {
                    updateStatus('info', '‚ö†Ô∏è Level Up non d√©clench√© (d√©j√† niveau max ou XP insuffisant)');
                    testResults.push({ test: 'Level Up', status: 'SKIP', reason: 'Conditions non remplies', time: new Date() });
                }
            } catch (error) {
                updateStatus('error', '‚ùå Erreur level up: ' + error.message);
                testResults.push({ test: 'Level Up', status: 'FAIL', error: error.message, time: new Date() });
            }
        }

        function runIntegrationTest() {
            updateStatus('info', 'üîÑ Test int√©gration syst√®mes...');
            
            try {
                if (!window.testXPManager) {
                    throw new Error('XP Manager non initialis√©');
                }
                
                // Test int√©gration avec streak
                const initialXP = window.testXPManager.xpData.currentXP;
                window.streakManager.streakData.currentStreak = 5; // Simuler streak actif
                
                const result = window.testXPManager.addXP(30, 'integration_test', { perfect: true });
                
                if (result.bonusDetails.length > 0) {
                    updateStatus('success', `‚úÖ Int√©gration r√©ussie: ${result.bonusDetails.join(', ')}`);
                    testResults.push({ test: 'Int√©gration', status: 'PASS', bonuses: result.bonusDetails, time: new Date() });
                } else {
                    updateStatus('info', '‚ö†Ô∏è Aucun bonus appliqu√© - V√©rifier logique bonus');
                    testResults.push({ test: 'Int√©gration', status: 'PARTIAL', time: new Date() });
                }
            } catch (error) {
                updateStatus('error', '‚ùå Erreur int√©gration: ' + error.message);
                testResults.push({ test: 'Int√©gration', status: 'FAIL', error: error.message, time: new Date() });
            }
        }

        function runStressTest() {
            updateStatus('info', 'üîÑ Test robustesse...');
            
            try {
                if (!window.testXPManager) {
                    throw new Error('XP Manager non initialis√©');
                }
                
                // Test multiples op√©rations rapides
                for (let i = 0; i < 10; i++) {
                    window.testXPManager.addXP(5, 'stress_test', { iteration: i });
                }
                
                // Test valeurs limites
                window.testXPManager.addXP(0, 'zero_test');
                window.testXPManager.addXP(-5, 'negative_test');
                window.testXPManager.addXP(1000, 'large_test');
                
                updateStatus('success', '‚úÖ Test robustesse r√©ussi - Syst√®me stable');
                testResults.push({ test: 'Robustesse', status: 'PASS', operations: 13, time: new Date() });
            } catch (error) {
                updateStatus('error', '‚ùå Erreur robustesse: ' + error.message);
                testResults.push({ test: 'Robustesse', status: 'FAIL', error: error.message, time: new Date() });
            }
        }

        // Simulations utilisateur
        function simulateChildSession() {
            updateStatus('info', 'üß™ Simulation session enfant...');
            const log = document.getElementById('simulation-log');
            log.style.display = 'block';
            log.innerHTML = '<div>üéÆ D√©but session enfant testeur...</div>';
            
            let step = 0;
            const steps = [
                () => {
                    log.innerHTML += '<div>üëÄ Enfant d√©couvre interface XP</div>';
                    if (window.testXPManager) window.testXPManager.log('Enfant regarde barre XP');
                },
                () => {
                    log.innerHTML += '<div>üéØ Premi√®re activit√© (Quiz facile)</div>';
                    if (window.testXPManager) {
                        const result = window.testXPManager.addXP(15, 'quiz_facile', { difficulty: 'easy' });
                        log.innerHTML += `<div>‚ú® +${result.xpGained}XP - R√©action positive observ√©e</div>`;
                    }
                },
                () => {
                    log.innerHTML += '<div>üî• Bonus streak d√©couvert</div>';
                    if (window.testXPManager) {
                        const result = window.testXPManager.addXP(20, 'quiz_moyen', { perfect: true });
                        log.innerHTML += `<div>üéâ Performance parfaite! +${result.xpGained}XP</div>`;
                    }
                },
                () => {
                    log.innerHTML += '<div>üìà Progression vers niveau suivant</div>';
                    if (window.testXPManager) {
                        const progress = window.testXPManager.getNextLevelProgress();
                        log.innerHTML += `<div>üìä Progression: ${progress.progress}% - Motivation maintenue</div>`;
                    }
                },
                () => {
                    log.innerHTML += '<div>‚úÖ Session termin√©e - Enfant demande √† continuer demain</div>';
                    updateStatus('success', '‚úÖ Simulation r√©ussie - Engagement enfant valid√©');
                }
            ];
            
            function executeStep() {
                if (step < steps.length) {
                    steps[step]();
                    step++;
                    setTimeout(executeStep, 1500);
                }
            }
            
            executeStep();
        }

        function simulateQuickActivity() {
            if (!window.testXPManager) {
                updateStatus('error', 'XP Manager non initialis√©');
                return;
            }
            
            const activities = ['quiz_francais', 'vocab_anglais', 'calcul_mental', 'mini_jeu'];
            const activity = activities[Math.floor(Math.random() * activities.length)];
            const perfect = Math.random() > 0.3; // 70% chance perfect
            
            const result = window.testXPManager.addXP(
                Math.floor(Math.random() * 30) + 10, 
                activity, 
                { perfect, responseTime: Math.random() * 5000 + 1000 }
            );
            
            updateStatus('success', `üéØ Activit√© ${activity}: +${result.xpGained}XP ${perfect ? '‚≠ê' : ''}`);
        }

        function simulatePerfectStreak() {
            if (!window.testXPManager) {
                updateStatus('error', 'XP Manager non initialis√©');
                return;
            }
            
            // Simuler s√©rie parfaite avec streak √©lev√©
            window.streakManager.streakData.currentStreak = 7;
            window.heartSystem.heartsData.currentHearts = 5;
            
            const result = window.testXPManager.addXP(40, 'session_parfaite', { 
                perfect: true, 
                difficulty: 'hard',
                responseTime: 2000
            });
            
            updateStatus('success', `üî• Session parfaite: +${result.xpGained}XP! ${result.bonusDetails.join(' ')}`);
        }

        // Utilitaires interface
        function updateStatus(type, message) {
            const statusDiv = document.getElementById('test-status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function toggleConsole() {
            const console = document.getElementById('debug-console');
            consoleVisible = !consoleVisible;
            console.style.display = consoleVisible ? 'block' : 'none';
        }

        function clearConsole() {
            document.getElementById('debug-console').innerHTML = '';
        }

        function exportTestData() {
            const data = {
                testResults,
                timestamp: new Date().toISOString(),
                xpStats: window.testXPManager ? window.testXPManager.debug.getStats() : null,
                streakData: window.streakManager.streakData,
                heartData: window.heartSystem.heartsData
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `test-results-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            updateStatus('success', 'üìÅ Donn√©es export√©es avec succ√®s');
        }

        // Auto-initialisation
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                runInitializationTest();
            }, 500);
        });
    </script>
</body>
</html>