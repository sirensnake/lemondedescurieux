<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DEBUG Mindmap - Zones Cliquables</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      background: #1a1a1a;
      color: white;
      font-family: monospace;
    }
    
    .container {
      max-width: 100%;
      margin: 0 auto;
    }
    
    h1 {
      color: #00ff00;
      text-align: center;
    }
    
    .mindmap-wrapper {
      position: relative;
      display: inline-block;
      background: #2a2a2a;
      padding: 10px;
      border-radius: 10px;
    }
    
    .mindmap {
      display: block;
      max-width: 100%;
      height: auto;
    }
    
    .debug-zone {
      position: absolute;
      border: 3px solid red;
      border-radius: 50%;
      pointer-events: none;
      opacity: 0.6;
      box-sizing: border-box;
    }
    
    .debug-label {
      position: absolute;
      background: rgba(255, 0, 0, 0.9);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: bold;
      pointer-events: none;
      white-space: nowrap;
      z-index: 1000;
    }
    
    .crosshair {
      position: absolute;
      pointer-events: none;
    }
    
    .crosshair-h {
      position: absolute;
      width: 20px;
      height: 2px;
      background: yellow;
      left: -10px;
    }
    
    .crosshair-v {
      position: absolute;
      width: 2px;
      height: 20px;
      background: yellow;
      top: -10px;
    }
    
    .info-panel {
      background: #2a2a2a;
      padding: 20px;
      margin-top: 20px;
      border-radius: 10px;
      border: 2px solid #00ff00;
    }
    
    .coords-list {
      list-style: none;
      padding: 0;
    }
    
    .coords-list li {
      padding: 8px;
      margin: 5px 0;
      background: #3a3a3a;
      border-radius: 5px;
      border-left: 4px solid #00ff00;
    }
    
    .coords-list li:hover {
      background: #4a4a4a;
    }
    
    .btn {
      background: #00ff00;
      color: black;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      margin: 5px;
    }
    
    .btn:hover {
      background: #00cc00;
    }
    
    .click-info {
      background: #3a3a3a;
      padding: 10px;
      margin-top: 10px;
      border-radius: 5px;
      font-size: 14px;
    }
    
    .click-marker {
      position: absolute;
      width: 10px;
      height: 10px;
      background: lime;
      border: 2px solid white;
      border-radius: 50%;
      transform: translate(-5px, -5px);
      pointer-events: none;
      z-index: 999;
      box-shadow: 0 0 10px lime;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîç DEBUG MINDMAP - ZONES CLIQUABLES</h1>
    
    <div class="info-panel">
      <h2>üìã Instructions</h2>
      <p>‚úÖ Les zones rouges montrent o√π sont actuellement les clics</p>
      <p>‚úÖ Clique sur l'image pour voir les coordonn√©es exactes</p>
      <p>‚úÖ Les coordonn√©es s'afficheront en bas en temps r√©el</p>
      <button class="btn" onclick="toggleZones()">üéØ Afficher/Masquer Zones</button>
      <button class="btn" onclick="exportCoords()">üìã Copier Coordonn√©es</button>
      <button class="btn" onclick="clearMarkers()">üßπ Effacer Marqueurs</button>
    </div>
    
    <div class="mindmap-wrapper" id="mindmap-wrapper">
      <img src="images/mindmap_lemondedescurieux_v2.png" 
           class="mindmap" 
           id="mindmap-img"
           usemap="#matieresmap"
           alt="Mindmap debug">
      
      <!-- Les zones de debug seront inject√©es ici -->
    </div>
    
    <map name="matieresmap">
      <!-- Zones actuelles -->
      <area shape="circle" coords="688,284,172" data-section="francais" alt="Fran√ßais">
      <area shape="circle" coords="2064,284,172" data-section="maths" alt="Maths">
      <area shape="circle" coords="401,768,172" data-section="histoire" alt="Histoire-G√©o">
      <area shape="circle" coords="2350,768,172" data-section="anglais" alt="Anglais">
      <area shape="circle" coords="688,1251,172" data-section="sciences" alt="Sciences">
      <area shape="circle" coords="2064,1251,172" data-section="ressources" alt="Ressources">
      <area shape="circle" coords="1032,1422,143" data-section="dashboard" alt="Mon Parcours">
      <area shape="circle" coords="1720,1422,143" data-section="infos" alt="Infos">
    </map>
    
    <div class="info-panel">
      <h2>üìä Coordonn√©es Actuelles</h2>
      <ul class="coords-list" id="coords-list">
        <!-- Rempli par JavaScript -->
      </ul>
      
      <div class="click-info" id="click-info">
        <strong>Cliquez sur l'image pour voir les coordonn√©es...</strong>
      </div>
    </div>
    
    <div class="info-panel">
      <h2>üìù Nouvelles Coordonn√©es (√† copier)</h2>
      <textarea id="new-coords" style="width: 100%; height: 300px; background: #1a1a1a; color: #00ff00; border: 1px solid #00ff00; padding: 10px; font-family: monospace; font-size: 12px;">
<!-- Les nouvelles coordonn√©es s'afficheront ici apr√®s vos clics -->
      </textarea>
    </div>
  </div>

  <script>
    const areas = document.querySelectorAll('area');
    const wrapper = document.getElementById('mindmap-wrapper');
    const img = document.getElementById('mindmap-img');
    const coordsList = document.getElementById('coords-list');
    const clickInfo = document.getElementById('click-info');
    const newCoordsTextarea = document.getElementById('new-coords');
    
    let zonesVisible = true;
    let clickedCoords = [];
    
    // Attendre que l'image soit charg√©e
    img.addEventListener('load', () => {
      initDebug();
    });
    
    // Si l'image est d√©j√† charg√©e
    if (img.complete) {
      initDebug();
    }
    
    function initDebug() {
      console.log('üîç DEBUG MODE ACTIF');
      console.log('Image dimensions:', img.naturalWidth, 'x', img.naturalHeight);
      console.log('Zones trouv√©es:', areas.length);
      
      drawDebugZones();
      listCoords();
      setupClickListener();
    }
    
    function drawDebugZones() {
      // Nettoyer anciennes zones
      document.querySelectorAll('.debug-zone, .debug-label, .crosshair').forEach(el => el.remove());
      
      areas.forEach((area, index) => {
        const coords = area.coords.split(',').map(Number);
        const [x, y, radius] = coords;
        const section = area.getAttribute('data-section') || area.alt || `Zone ${index + 1}`;
        
        // Calculer position proportionnelle
        const imgRect = img.getBoundingClientRect();
        const wrapperRect = wrapper.getBoundingClientRect();
        
        const scaleX = imgRect.width / img.naturalWidth;
        const scaleY = imgRect.height / img.naturalHeight;
        
        const scaledX = x * scaleX;
        const scaledY = y * scaleY;
        const scaledRadius = radius * scaleX;
        
        // Cr√©er cercle de debug
        const circle = document.createElement('div');
        circle.className = 'debug-zone';
        circle.style.left = (scaledX - scaledRadius) + 'px';
        circle.style.top = (scaledY - scaledRadius) + 'px';
        circle.style.width = (scaledRadius * 2) + 'px';
        circle.style.height = (scaledRadius * 2) + 'px';
        
        // Cr√©er label
        const label = document.createElement('div');
        label.className = 'debug-label';
        label.textContent = `${index + 1}: ${section}`;
        label.style.left = scaledX + 'px';
        label.style.top = (scaledY - scaledRadius - 20) + 'px';
        label.style.transform = 'translateX(-50%)';
        
        // Cr√©er crosshair au centre
        const crosshair = document.createElement('div');
        crosshair.className = 'crosshair';
        crosshair.style.left = scaledX + 'px';
        crosshair.style.top = scaledY + 'px';
        
        const hLine = document.createElement('div');
        hLine.className = 'crosshair-h';
        const vLine = document.createElement('div');
        vLine.className = 'crosshair-v';
        
        crosshair.appendChild(hLine);
        crosshair.appendChild(vLine);
        
        wrapper.appendChild(circle);
        wrapper.appendChild(label);
        wrapper.appendChild(crosshair);
      });
    }
    
    function listCoords() {
      coordsList.innerHTML = '';
      
      areas.forEach((area, index) => {
        const coords = area.coords.split(',').map(Number);
        const [x, y, radius] = coords;
        const section = area.getAttribute('data-section') || area.alt || `Zone ${index + 1}`;
        
        const li = document.createElement('li');
        li.innerHTML = `
          <strong>${index + 1}. ${section}</strong><br>
          coords="${x},${y},${radius}"<br>
          <small>X: ${x}px, Y: ${y}px, Radius: ${radius}px</small>
        `;
        
        coordsList.appendChild(li);
      });
    }
    
    function setupClickListener() {
      img.addEventListener('click', (e) => {
        const rect = img.getBoundingClientRect();
        
        // Position relative dans l'image affich√©e
        const displayX = e.clientX - rect.left;
        const displayY = e.clientY - rect.top;
        
        // Conversion en coordonn√©es originales
        const scaleX = img.naturalWidth / rect.width;
        const scaleY = img.naturalHeight / rect.height;
        
        const originalX = Math.round(displayX * scaleX);
        const originalY = Math.round(displayY * scaleY);
        
        // Ajouter marqueur visuel
        const marker = document.createElement('div');
        marker.className = 'click-marker';
        marker.style.left = displayX + 'px';
        marker.style.top = displayY + 'px';
        wrapper.appendChild(marker);
        
        // Stocker coordonn√©es
        clickedCoords.push({ x: originalX, y: originalY });
        
        // Afficher info
        clickInfo.innerHTML = `
          <strong>üìç Dernier clic :</strong><br>
          Position affich√©e: (${Math.round(displayX)}, ${Math.round(displayY)})<br>
          <strong style="color: #00ff00;">Coordonn√©es originales: (${originalX}, ${originalY})</strong><br>
          <em>Total clics: ${clickedCoords.length}</em>
        `;
        
        console.log('üéØ Clic enregistr√©:', { originalX, originalY, display: { displayX, displayY } });
        
        // Mettre √† jour textarea si on a assez de clics
        updateNewCoords();
      });
    }
    
    function updateNewCoords() {
      if (clickedCoords.length === 0) return;
      
      let output = '<!-- NOUVELLES COORDONN√âES BAS√âES SUR VOS CLICS -->\n\n';
      output += `<!-- Total de clics enregistr√©s: ${clickedCoords.length} -->\n\n`;
      
      clickedCoords.forEach((coord, index) => {
        output += `<!-- Clic ${index + 1}: (${coord.x}, ${coord.y}) -->\n`;
      });
      
      output += '\n<!-- Si vous avez cliqu√© sur chaque section dans l\'ordre:\n';
      output += '1. Fran√ßais (top-left)\n';
      output += '2. Math√©matiques (top-right)\n';
      output += '3. Histoire-G√©o (middle-left)\n';
      output += '4. Anglais (middle-right)\n';
      output += '5. Sciences (bottom-left)\n';
      output += '6. Ressources (bottom-right)\n';
      output += '7. Mon Parcours (bottom-left-center)\n';
      output += '8. Infos & News (bottom-right-center)\n';
      output += '-->\n\n';
      
      if (clickedCoords.length >= 8) {
        const sections = [
          { name: 'Fran√ßais', dataSection: 'francais', radius: 172 },
          { name: 'Math√©matiques', dataSection: 'maths', radius: 172 },
          { name: 'Histoire-G√©ographie', dataSection: 'histoire', radius: 172 },
          { name: 'Anglais', dataSection: 'anglais', radius: 172 },
          { name: 'Sciences', dataSection: 'sciences', radius: 172 },
          { name: 'Ressources', dataSection: 'ressources', radius: 172 },
          { name: 'Mon Parcours', dataSection: 'dashboard', radius: 143 },
          { name: 'Infos & News', dataSection: 'infos', radius: 143 }
        ];
        
        output += '<map name="matieresmap">\n';
        
        clickedCoords.slice(0, 8).forEach((coord, index) => {
          const section = sections[index];
          output += `  <area shape="circle" \n`;
          output += `        coords="${coord.x},${coord.y},${section.radius}" \n`;
          output += `        href="${section.dataSection === 'dashboard' ? 'dashboard_global.html' : section.dataSection + (section.dataSection === 'ressources' || section.dataSection === 'infos' ? '_section.html' : '_duolingo_section.html')}" \n`;
          output += `        alt="${section.name}" \n`;
          output += `        title="${section.name}" \n`;
          output += `        data-section="${section.dataSection}">\n\n`;
        });
        
        output += '</map>';
      }
      
      newCoordsTextarea.value = output;
    }
    
    function toggleZones() {
      zonesVisible = !zonesVisible;
      const zones = document.querySelectorAll('.debug-zone, .debug-label, .crosshair');
      zones.forEach(zone => {
        zone.style.display = zonesVisible ? 'block' : 'none';
      });
    }
    
    function exportCoords() {
      newCoordsTextarea.select();
      document.execCommand('copy');
      alert('‚úÖ Coordonn√©es copi√©es dans le presse-papiers !');
    }
    
    function clearMarkers() {
      document.querySelectorAll('.click-marker').forEach(m => m.remove());
      clickedCoords = [];
      clickInfo.innerHTML = '<strong>Marqueurs effac√©s. Cliquez sur l\'image pour recommencer...</strong>';
      newCoordsTextarea.value = '<!-- Les nouvelles coordonn√©es s\'afficheront ici apr√®s vos clics -->';
    }
    
    // Redessiner zones lors du redimensionnement
    window.addEventListener('resize', () => {
      drawDebugZones();
    });
  </script>
</body>
</html>
